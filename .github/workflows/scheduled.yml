name: VerificaciÃ³n Programada

# Este workflow se ejecuta automÃ¡ticamente segÃºn un schedule
on:
  schedule:
    - cron: '0 8 * * *'  # Diario a las 8:00 AM UTC
  workflow_dispatch:

jobs:
  health-check:
    name: ğŸ¥ Health Check del Sistema
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v3
      
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: ğŸ“¦ Instalar dependencias
        run: npm install
      
      - name: ğŸ¥ Ejecutar Health Check
        run: |
          echo "===================================="
          echo "ğŸ¥ INICIANDO HEALTH CHECK"
          echo "===================================="
          date
          npm test
          echo "âœ… Health Check completado exitosamente!"
      
      - name: ğŸ“Š EstadÃ­sticas del sistema
        run: |
          echo "Uptime:"; uptime
          echo "Disco:"; df -h | grep -E "Filesystem|/dev/root"
          echo "Memoria:"; free -h
          echo "Procesos activos:"; ps aux | wc -l

  scheduled-test:
    name: ğŸ§ª Tests Programados
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v3
      
      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: ğŸ“¦ Instalar dependencias
        run: npm install
      
      - name: ğŸ” Ejecutar ESLint
        run: npx eslint .
      
      - name: ğŸ§ª Ejecutar suite de tests
        run: npm test
      
      - name: ğŸ“ Log del resultado
        if: always()
        run: |
          echo "Workflow: ${{ github.workflow }}" > log.txt
          echo "Ejecutado: $(date)" >> log.txt
          echo "Disparador: ${{ github.event_name }}" >> log.txt
          echo "Repositorio: ${{ github.repository }}" >> log.txt

      - name: ğŸ“¤ Subir artifact del log
        uses: actions/upload-artifact@v3
        with:
          name: log-programado
          path: log.txt

  notify-status:
    name: ğŸ“¬ NotificaciÃ³n de Estado
    needs: [health-check, scheduled-test]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ğŸ“¬ Estado de la verificaciÃ³n
        run: |
          echo "Estado health-check: ${{ needs.health-check.result }}"
          echo "Estado scheduled-test: ${{ needs.scheduled-test.result }}"
          if [ "${{ needs.health-check.result }}" == "success" ] && [ "${{ needs.scheduled-test.result }}" == "success" ]; then
            echo "âœ… Todos los checks pasaron"
          else
            echo "âš ï¸ Algunos checks fallaron"; exit 1

