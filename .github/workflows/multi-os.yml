name: Tests Multi-OS

# Este workflow demuestra cÃ³mo ejecutar tests en mÃºltiples sistemas operativos
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  # Job con matrix strategy para ejecutar en mÃºltiples SO y versiones de Node
  test-matrix:
    name: Test en ${{ matrix.os }} con Node ${{ matrix.node-version }}
    runs-on: ${{ matrix.os }}
    
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, ubuntu-22.04, windows-latest, macos-latest]
        node-version: [16, 18, 20, 22]
    
    steps:
      - name: ğŸ“¥ Checkout del cÃ³digo
        uses: actions/checkout@v3
      
      - name: âš™ï¸ Configurar Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
      
      - name: ğŸ“¦ Instalar dependencias
        run: npm install
      
      # ğŸ” Linting del cÃ³digo con ESLint
      - name: ğŸ” Ejecutar ESLint
        run: npx eslint .

      - name: ğŸ§ª Ejecutar tests
        run: npm test
      
      # InformaciÃ³n especÃ­fica del SO
      - name: ğŸ’» InformaciÃ³n del Sistema Operativo
        shell: bash
        run: |
          echo "===================================="
          echo "Sistema: ${{ matrix.os }}"
          echo "Node.js: ${{ matrix.node-version }}"
          echo "Runner OS: $RUNNER_OS"
          echo "===================================="
          if [ "$RUNNER_OS" == "Linux" ]; then
            uname -a
            cat /etc/os-release
          elif [ "$RUNNER_OS" == "Windows" ]; then
            powershell "systeminfo | findstr /C:'OS'"
          elif [ "$RUNNER_OS" == "macOS" ]; then
            sw_vers
          fi
          echo "===================================="

  # Job que solo se ejecuta en Linux
  linux-specific:
    name: ğŸ§ Operaciones especÃ­ficas de Linux
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v3
      
      - name: ğŸ§ Comandos especÃ­ficos de Linux
        run: |
          echo "Estos comandos solo funcionan en Linux:"
          echo "===================================="
          cat /etc/os-release
          uname -r
          lscpu | grep "Model name"
          free -h
          ps aux | head -n 10

  # Job que solo se ejecuta en Windows
  windows-specific:
    name: ğŸªŸ Operaciones especÃ­ficas de Windows
    runs-on: windows-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v3
      
      - name: ğŸªŸ Comandos especÃ­ficos de Windows
        shell: pwsh
        run: |
          Write-Host "Estos comandos solo funcionan en Windows:"
          Write-Host "===================================="
          Get-ComputerInfo | Select-Object CsName, WindowsVersion, OsArchitecture
          Get-Process | Select-Object -First 10 Name, CPU, Id

  # Job que resume los resultados
  summary:
    name: ğŸ“Š Resumen de EjecuciÃ³n
    needs: [test-matrix, linux-specific, windows-specific]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ğŸ“Š Generar resumen
        run: |
          echo "===================================="
          echo "RESUMEN DE EJECUCIÃ“N MULTI-OS"
          echo "===================================="
          echo "âœ… Todos los jobs completados"
          echo "Tests ejecutados en Ubuntu, Windows, macOS"
          echo "Con Node.js versiones: 16, 18, 20, 22"
          echo "===================================="
          echo "Total de combinaciones: $(( 4 * 4 )) (4 OS x 4 versiones)"
          echo "===================================="
